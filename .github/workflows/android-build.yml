name: Android Release Build

on:
  workflow_dispatch:  # manually triggered
  push:
    branches:
      - main           # or 'release' if you use a release branch

jobs:
  build-android:
    name: Build Signed Android App
    runs-on: ubuntu-latest

    env:
      # Optional: Java home path for compatibility
      JAVA_HOME: /usr/lib/jvm/java-11-openjdk-amd64

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: âš™ï¸ Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: 17

      - name: ğŸ§± Install Node & Yarn
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Install dependencies
        run: |
          yarn install --frozen-lockfile

      - name: ğŸ” Decode Keystore from GitHub Secret
        run: |
          echo "${{ secrets.KEYSTORE_BASE64 }}" | base64 -d > android/app/my-release-key.keystore

      - name: ğŸ§¾ Inject Signing Credentials
        run: |
          echo "MYAPP_UPLOAD_STORE_FILE=my-release-key.keystore" >> android/gradle.properties
          echo "MYAPP_UPLOAD_KEY_ALIAS=${{ secrets.KEY_ALIAS }}" >> android/gradle.properties
          echo "MYAPP_UPLOAD_STORE_PASSWORD=${{ secrets.KEYSTORE_PASSWORD }}" >> android/gradle.properties
          echo "MYAPP_UPLOAD_KEY_PASSWORD=${{ secrets.KEY_PASSWORD }}" >> android/gradle.properties

      - name: ğŸ› ï¸ Build Signed AAB (App Bundle)
        working-directory: android
        run: ./gradlew bundleRelease

      # OPTIONAL: build APK instead
      # - name: ğŸ› ï¸ Build Signed APK
      #   working-directory: android
      #   run: ./gradlew assembleRelease

    #   - name: ğŸ“¤ Upload release AAB artifact
    #     uses: actions/upload-artifact@v3
    #     with:
    #       name: app-release.aab
    #       path: android/app/build/outputs/bundle/release/app-release.aab

      # OPTIONAL: Publish to Google Play with Fastlane
      # - name: ğŸš€ Deploy to Google Play
      #   run: |
      #     cd android
      #     bundle install
      #     fastlane deploy
